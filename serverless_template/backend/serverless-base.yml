# Base Serverless Framework Configuration Template
# Replace {{SERVICE_NAME}}, {{REGION}}, etc. with actual values

service: {{SERVICE_NAME}}
frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs20.x
  architecture: arm64
  region: {{REGION}}
  stage: ${opt:stage, 'dev'}

  environment:
    TABLE_NAME: !Ref MainTable
    STAGE: ${self:provider.stage}

  httpApi:
    cors: true
    # Uncomment if using authentication
    # authorizers:
    #   cognitoAuthorizer:
    #     type: jwt
    #     identitySource: $request.header.Authorization
    #     issuerUrl: !Sub https://cognito-idp.${AWS::Region}.amazonaws.com/${CognitoUserPool}
    #     audience:
    #       - !Ref CognitoUserPoolClient

  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - dynamodb:Scan
            - dynamodb:GetItem
            - dynamodb:PutItem
            - dynamodb:UpdateItem
            - dynamodb:DeleteItem
          Resource: !GetAtt MainTable.Arn
        - Effect: Allow
          Action:
            - logs:CreateLogGroup
            - logs:CreateLogStream
            - logs:PutLogEvents
          Resource: arn:aws:logs:*:*:*

functions:
  # Add your functions here
  # Example:
  # getItems:
  #   handler: src/functions/get.handler
  #   events:
  #     - httpApi:
  #         path: /items
  #         method: GET

resources:
  Resources:
    MainTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: ${self:service}-${self:provider.stage}-table
        BillingMode: PAY_PER_REQUEST
        AttributeDefinitions:
          - AttributeName: id
            AttributeType: S
        KeySchema:
          - AttributeName: id
            KeyType: HASH
        Tags:
          - Key: Environment
            Value: ${self:provider.stage}
          - Key: Service
            Value: ${self:service}

  Outputs:
    ApiEndpoint:
      Description: HTTP API Gateway endpoint URL
      Value: !Sub https://${HttpApi}.execute-api.${AWS::Region}.amazonaws.com
      Export:
        Name: ${self:service}-${self:provider.stage}-ApiEndpoint

    TableName:
      Description: DynamoDB table name
      Value: !Ref MainTable
      Export:
        Name: ${self:service}-${self:provider.stage}-TableName
